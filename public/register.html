<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css">
<title>Register</title>
<style>
	input[type=text], select {
	  width: 80%;
	  padding: 12px 20px;
	  margin: 8px 0;
	  display: inline-block;
	  border: 1px solid #ccc;
	  border-radius: 4px;
	  box-sizing: border-box;
	}
	input[type=submit] {
	  width: 100%;
	  background-color: #B9C4CB;
	  color: white;
	  padding: 14px 20px;
	  margin: 8px 0;
	  border: none;
	  border-radius: 4px;
	  cursor: pointer;
	}
	input[type=submit]:hover {
	  background-color: #A5B2BB;
	}
	div {
	  border-radius: 5px;
	  background-color: #f2f2f2;
	  padding: 20px;
	}
	/*body {
		width: 60%;
		margin-left: auto;
		margin-right: auto;
	}*/
</style>
<script>
	function validateForm() {
		var user_name = document.forms[0]["name"].value;
	  var password = document.forms[0]["password"].value;
		var password_2 = document.forms[0]["password_2"].value;
		if (user_name == "" || password == "" || password_2 == "") {
			alert("Please fill in all three boxes to complete registering.");
			return false;
		}
		if (password != password_2) {
	    alert("Please fill in matching password.");
	    return false;
	  }
	}
</script>
</head>


<body>
  <h1>Register</h1>
  <div>
  <form id="register_form" onsubmit="validateForm()">
     User name: <input type = "text" name = "name">  <br>
		 Email: <input type = "text" name = "email">  <br>
		 Password: <input type = "text" name = "password">  <br>
		 Password again: <input type = "text" name = "password_2">  <br>
     <input type = "submit" value = "Submit">
  </form>
	<a href="login.html">login</a>
  </div>
	
	<script>
		const register_form = document.getElementById("register_form");
		
		function insertForm(e) {
			e.preventDefault();
			var name = document.forms[0]["name"].value;
			var password = document.forms[0]["password"].value;
			var email = document.forms[0]["email"].value;
			
			register_data = {"user": name, "email": email, "password": password}
			fetch("/register", {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify(register_data)
			})
			.then(response => {
				if(response.status == 200){
					window.location.href = "/login.html"
				} 
				window.location.href = "/register.html"
			})
			.catch((error) => {
				console.error('Error:', error);
			});
		}
		
		register_form.addEventListener("submit", insertForm);
		
	</script>
	
</body>
</html>